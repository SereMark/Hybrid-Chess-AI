from types import SimpleNamespace as _NS

SEED = 0


LOG = _NS(
    LEVEL="INFO",
    CUDA_EMPTY_CACHE_EVERY_ITERS=120,
    CHECKPOINT_SAVE_EVERY_ITERS=30,
    CHECKPOINT_FILE_PATH="checkpoint.pt",
    BEST_MODEL_FILE_PATH="best_model.pt",
    ARENA_LOG_CSV_ENABLE=False,
    ARENA_LOG_CSV_PATH="arena_log.csv",
    METRICS_LOG_CSV_ENABLE=True,
    METRICS_LOG_CSV_PATH="training_log.csv",
    ARENA_SAVE_PGN_ENABLE=False,
    ARENA_SAVE_PGN_ON_PROMOTION=True,
    ARENA_SAVE_PGN_SAMPLES_PER_ROUND=4,
)


TORCH = _NS(
    AMP_ENABLED=True,
    MATMUL_FLOAT32_PRECISION="high",
    CUDNN_BENCHMARK=True,
    COMPILE=True,
    COMPILE_MODE="max-autotune",
    COMPILE_FULLGRAPH=True,
    COMPILE_DYNAMIC=True,
    THREADS_INTRA=1,
    THREADS_INTER=1,
    MODEL_CHANNELS_LAST=True,
    EVAL_MODEL_CHANNELS_LAST=True,
    TRAIN_PIN_MEMORY=True,
    EVAL_PIN_MEMORY=True,
)


DATA = _NS(
    U8_SCALE=255.0,
    VALUE_I8_SCALE=127.0,
)


MODEL = _NS(
    BLOCKS=12,
    CHANNELS=224,
    VALUE_CONV_CHANNELS=16,
    VALUE_HIDDEN_DIM=1024,
)


EVAL = _NS(
    COALESCE_MS=22,
    WORKER_JOIN_TIMEOUT_S=0.15,
    CACHE_USE_FP16=True,
    BATCH_SIZE_MAX=1024,
    CACHE_CAPACITY=40_000,
    ARENA_CACHE_CAPACITY=20_000,
)


SELFPLAY = _NS(
    NUM_WORKERS=6,
    GAME_MAX_PLIES=320,
    TEMP_MOVES=15,
    TEMP_HIGH=1.00,
    TEMP_LOW=0.05,
    DETERMINISTIC_TEMP_EPS=0.005,
    OPENING_RANDOM_PLIES_MAX=6,
)

REPLAY = _NS(
    BUFFER_CAPACITY=120_000,
)

SAMPLING = _NS(
    REPLAY_SNAPSHOT_RECENT_WINDOW_FRAC=0.15,
    REPLAY_SNAPSHOT_RECENT_RATIO_DEFAULT=0.60,
    TRAIN_RECENT_SAMPLE_RATIO=0.60,
)

AUGMENT = _NS(
    MIRROR_PROB=0.50,
    ROT180_PROB=0.25,
    VFLIP_CS_PROB=0.25,
)


MCTS = _NS(
    TRAIN_SIMULATIONS_BASE=512,
    TRAIN_SIMULATIONS_MIN=384,
    TRAIN_SIM_DECAY_MOVE_INTERVAL=12,
    C_PUCT=1.35,
    C_PUCT_BASE=19652.0,
    C_PUCT_INIT=1.55,
    DIRICHLET_ALPHA=0.30,
    DIRICHLET_WEIGHT=0.15,
    FPU_REDUCTION=0.12,
    VISIT_COUNT_CLAMP=65535,
)


RESIGN = _NS(
    VALUE_THRESHOLD=-0.85,
    CONSECUTIVE_PLIES=3,
    CONSECUTIVE_MIN=3,
    PLAYTHROUGH_FRACTION=0.33,
    DISABLE_UNTIL_ITERS=40,
)


TRAIN = _NS(
    LR_INIT=1.8e-3,
    LR_WARMUP_STEPS=2000,
    LR_FINAL=6.5e-4,
    LR_SCHED_STEPS_PER_ITER_EST=36,
    LR_SCHED_DRIFT_ADJUST_THRESHOLD=15.0,
    WEIGHT_DECAY=2e-4,
    MOMENTUM=0.9,
    GRAD_CLIP_NORM=0.80,
    LOSS_POLICY_WEIGHT=1.0,
    LOSS_VALUE_WEIGHT=0.8,
    LOSS_VALUE_WEIGHT_LATE=1.0,
    LOSS_VALUE_WEIGHT_SWITCH_ITER=30,
    LOSS_POLICY_LABEL_SMOOTH=0.03,
    LOSS_ENTROPY_COEF_INIT=1.0e-4,
    LOSS_ENTROPY_ANNEAL_ITERS=100,
    LOSS_ENTROPY_COEF_MIN=5.0e-05,
    EMA_ENABLED=True,
    EMA_DECAY=0.9995,
    TOTAL_ITERATIONS=168,
    GAMES_PER_ITER=360,
    TARGET_TRAIN_SAMPLES_PER_NEW=3.0,
    UPDATE_STEPS_MIN=16,
    UPDATE_STEPS_MAX=32,
    BATCH_SIZE_MIN=2048,
    BATCH_SIZE_MAX=2048,
    BATCH_SIZE=2048,
)


ARENA = _NS(
    MCTS_EVAL_SIMULATIONS=512,
    EVAL_EVERY_ITERS=8,
    GAMES_PER_EVAL=120,
    TEMPERATURE=0.0,
    TEMP_MOVES=0,
    DIRICHLET_WEIGHT=0.0,
    OPENING_TEMPERATURE_EPS=1e-6,
    DETERMINISTIC=True,
    DRAW_SCORE=0.50,
    GATE_DRAW_WEIGHT=0.50,
    GATE_BASELINE_P=0.5,
    GATE_Z_EARLY=1.64,
    GATE_Z_LATE=2.05,
    GATE_Z_SWITCH_ITER=200,
    GATE_MIN_GAMES=240,
    GATE_DECISIVE_SECONDARY=True,
    GATE_MIN_DECISIVES=100,
    CANDIDATE_MAX_ROUNDS=4,
    CANDIDATE_MAX_GAMES=600,
    PAIRING_FACTOR=2,
    GATE_EPS=1e-9,
)
